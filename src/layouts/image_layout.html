<script>
(function() {
  function $(className) {
    var prefix = className[0];
    var rest = className.slice(1);
    if (prefix === '.') {
      return Array.prototype.slice.call(document.getElementsByClassName(rest));
    } else if (prefix === '#') {
      return [document.getElementById(rest)];
    } else {
      throw new Error('improper prefix passed to $ function: ' + prefix);
    }
  }

  function getNumColumns() {
    var w = window.innerWidth;
    return w <= 525 ? 1 : w <= 1024 ? 2 : 3;
  }

  function getMinIndex(arr) {
    if (arr.length === 0) return -1;
    var min = arr[0];
    var idx = 0;
    for (var i = 1; i < arr.length; i++) {
      if (arr[i] < min) {
        min = arr[i];
        idx = i;
      }
    }
    return idx;
  }

  function runFormat() {
    // Reset formatting set by this function
    $('.portfolio-thumbnail').forEach(function(el) {
      el.style.top = null;
      el.style.left = null;
      el.style.width = null;
    });

    var numColumns = getNumColumns();
    if (numColumns === 1) { return; } // Don't worry about the single-column case

    var totalWidth = $('.portfolio-list')[0].getBoundingClientRect().width;
    var padding = totalWidth * 0.02 / numColumns;
    var imgWidth = (totalWidth - ((numColumns - 1) * padding)) / numColumns;

    var sums = [];
    for (var col = 0; col < numColumns; col++) { sums.push(0); }

    $('.portfolio-thumbnail').forEach(function(el) {
      var colToPlace = getMinIndex(sums);
      el.style.width = imgWidth + 'px';
      el.style.top = sums[colToPlace] + 'px';
      el.style.left = colToPlace * (imgWidth + padding) + 'px';
      sums[colToPlace] += el.getBoundingClientRect().height + padding;
      // Not available on some browsers, that's ok they'll get pop-in
      try { el.classList.remove('thumbnail-invisible'); } catch (_) {}
    });
  }

  window.addEventListener('load', runFormat);
  window.addEventListener('resize', runFormat);
})();
</script>
