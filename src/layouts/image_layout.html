<script>
(function() {
  function $(className) {
    var prefix = className[0];
    var rest = className.slice(1);
    if (prefix === '.') {
      return Array.prototype.slice.call(document.getElementsByClassName(rest));
    } else if (prefix === '#') {
      return [document.getElementById(rest)];
    } else {
      throw new Error('improper prefix passed to $ function: ' + prefix);
    }
  }

  function getNumColumns() {
    var w = window.innerWidth;
    return w <= 525 ? 1 : w <= 1024 ? 2 : 3;
  }

  function getMinIndex(arr) {
    if (arr.length === 0) return -1;
    var min = arr[0];
    var idx = 0;
    for (var i = 1; i < arr.length; i++) {
      if (arr[i] < min) {
        min = arr[i];
        idx = i;
      }
    }
    return idx;
  }

  function getPaddedLeft(col, totalWidth, totalCols) {
    var padding = 2;
    return col * ((totalWidth - ((totalCols - 1) * padding)) / totalCols) + Math.max(0, col - 1) * padding;
  }

  function runFormat() {
    var numColumns = getNumColumns();
    $('.portfolio-thumbnail').forEach(function(el) { el.style.top = null; el.style.left = null; });

    if (numColumns === 1) { return; } // Don't worry about the single-column case
    var totalWidth = $('.portfolio-list')[0].getBoundingClientRect().width;
    // var padding = 2;
    // var imgWidth = (totalWidth - ((numColumns - 1) * padding)) / numColumns;

    var sums = [];
    for (var col = 0; col < numColumns; col++) { sums.push(0); }


    $('.portfolio-thumbnail').forEach(function(el) {
      var colToPlace = getMinIndex(sums);
      var height = el.getBoundingClientRect().height;
      el.style.top = sums[colToPlace] + 'px';
      sums[colToPlace] += height;
      el.style.left = colToPlace * (totalWidth / numColumns) + 'px';
    });
  }

  window.addEventListener('load', runFormat);
  window.addEventListener('resize', runFormat);
})();
</script>
